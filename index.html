<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Blackjack Game</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.3/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.1.3/core.js"></script>
  <style>
    body { font-family: monospace; padding: 20px; }
    #game-output { white-space: pre-wrap; background: #f4f4f4; padding: 10px; border-radius: 8px; min-height: 200px; }
    input, button { padding: 6px 10px; margin-top: 10px; font-size: 16px; }
  </style>
</head>
<body>

<h1>Blackjack in PyScript</h1>

<div id="game-output">Loading...</div>

<input id="user-input" type="text" placeholder="Type 'y' or 'n'" />
<button py-click="get_input()">Submit</button>

<py-script type="py">
import random
from pyscript import Element

output = Element("game-output")

logo = """
.------.         _     _               _
|A_ _ |.        | |   | |             | |
|( \\/ ).-----.  | |__ | | __ _ ___| | ___ __ _ ___| | __
| \\  /|K /\\  |  | '_ \\| |/ _` |/ __| |/ / |/ _` |/ __| |/ /
|  \\/ | /  \\ |  | |_) | | (_| | (__|  <| | (_| | (__|  <
`-----| \\  / |  |_.__/|_|\\__,_|\\___|_|\\_\\ |\\__,_|\\___|_|\\_\\
      |  \\/ K|                               _/ |
      `------'                              |__/
"""

user_cards = []
opponent_cards = []
game_over = False
stage = "init"

def deal_card():
    return random.choice([11, 2, 3, 4, 5, 6, 7, 8, 9, 10, 10, 10, 10])

def calculate_score(cards):
    if sum(cards) == 21 and len(cards) == 2:
        return 0
    if 11 in cards and sum(cards) > 21:
        cards.remove(11)
        cards.append(1)
    return sum(cards)

def compare(u_score, o_score):
    if u_score == o_score:
        return "It's a draw 🙃"
    elif o_score == 0:
        return "You lose! Opponent got a Blackjack! 😱"
    elif u_score == 0:
        return "You win with a Blackjack! 😎"
    elif u_score > 21:
        return "You went over 21.. You lose! 😭"
    elif o_score > 21:
        return "Opponent went over 21.. You win! 😁"
    elif u_score > o_score:
        return "You win! 😃"
    else:
        return "You lose! 😭"

def start_game():
    global user_cards, opponent_cards, game_over, stage
    output.clear()
    output.write(logo + "\n")
    user_cards.clear()
    opponent_cards.clear()
    user_cards.extend([deal_card(), deal_card()])
    opponent_cards.extend([deal_card(), deal_card()])
    stage = "player_turn"
    show_status()

def show_status():
    user_score = calculate_score(user_cards)
    output.write(f"\nYour cards: {user_cards}, current score: {user_score}")
    output.write(f"\nOpponent's first card: {opponent_cards[0]}")
    if user_score == 0 or calculate_score(opponent_cards) == 0 or user_score > 21:
        end_game()

def opponent_play():
    global stage
    while calculate_score(opponent_cards) != 0 and calculate_score(opponent_cards) < 17:
        opponent_cards.append(deal_card())
    end_game()

def end_game():
    global stage
    user_score = calculate_score(user_cards)
    opponent_score = calculate_score(opponent_cards)
    output.write(f"\n\nYour final hand: {user_cards}, final score: {user_score}")
    output.write(f"\nOpponent's final hand: {opponent_cards}, final score: {opponent_score}")
    output.write(f"\n\n{compare(user_score, opponent_score)}")
    output.write("\n\nDo you want to play again? Type 'y' or 'n':")
    stage = "init"

def get_input():
    global stage
    user_input = Element("user-input").value.strip().lower()
    Element("user-input").value = ""

    if stage == "init":
        if user_input == "y":
            start_game()
        else:
            output.write("\nThanks for playing!")
    elif stage == "player_turn":
        if user_input == "y":
            user_cards.append(deal_card())
            if calculate_score(user_cards) > 21:
                end_game()
            else:
                show_status()
        elif user_input == "n":
            stage = "opponent_turn"
            opponent_play()

# Initial prompt
output.clear()
output.write("Do you want to play a game of Blackjack? Type 'y' or 'n':")
</py-script>

</body>
</html>
